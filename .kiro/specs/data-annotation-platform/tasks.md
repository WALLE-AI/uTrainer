# 实施计划：数据标注平台

## 概述

本实施计划将数据标注平台的设计转化为可执行的开发任务。任务按照模块划分，每个任务都包含具体的实现步骤和需求引用。标记为 `*` 的任务为可选任务，可以根据项目优先级决定是否实施。

## 任务列表

### 阶段 1: 项目基础设施和核心类型

- [ ] 1. 设置项目基础结构
  - 初始化 Vite + React + TypeScript 项目
  - 配置 Tailwind CSS
  - 设置 ESLint 和 Prettier
  - 配置路由（React Router v6）
  - _需求: 24.1_

- [ ] 2. 定义核心数据类型
  - 创建 `types/annotation.ts` 定义标注相关类型
  - 创建 `types/project.ts` 定义项目和任务类型
  - 创建 `types/user.ts` 定义用户类型
  - 创建 `types/dataset.ts` 定义数据集类型
  - _需求: 2.1, 3.1, 4.1_

- [ ] 3. 设置数据存储层
  - 实现 IndexedDB 封装类 `utils/db.ts`
  - 创建数据库 schema（projects, tasks, annotations, cache）
  - 实现基础 CRUD 操作
  - _需求: 24.1, 24.2_

- [ ]*3.1 编写数据存储层单元测试
  - 测试 IndexedDB CRUD 操作
  - 测试数据验证逻辑
  - _需求: 24.1_

### 阶段 2: 标注工作室 - 数据导入

- [ ] 4. 实现数据导入核心逻辑
  - [ ] 4.1 创建 DataImporter 组件框架
    - 实现文件选择和拖拽上传 UI
    - 实现导入类型选择（本地/数据集）
    - _需求: 1.1, 1.2_
  
  - [ ] 4.2 实现本地文件导入
    - 实现图片文件导入和预览
    - 实现视频文件导入和元数据提取
    - 实现文件大小和格式验证
    - _需求: 1.2_
  
  - [ ] 4.3 实现 COCO 格式解析器
    - 解析 COCO JSON 文件
    - 转换标注数据到内部格式
    - 提取类别信息
    - _需求: 1.3, 1.4_
  
  - [ ] 4.4 实现 YOLO 格式解析器
    - 解析 YOLO TXT 文件
    - 解析类别配置文件
    - 转换坐标格式（中心点 → 左上角）
    - _需求: 1.3, 1.4_
  
  - [ ] 4.5 实现其他格式解析器
    - 实现 Pascal VOC (XML) 解析器
    - 实现 CVAT 解析器
    - 实现 LabelMe 解析器
    - _需求: 1.3, 1.4_

- [ ]*4.6 编写数据导入属性测试
  - **属性 12: 数据导出往返一致性**
  - **验证需求: 1.4**
  - 测试导入然后导出应该得到等价数据

- [ ] 5. 实现导入工作流 UI
  - 创建 ImportWorkflow 组件
  - 实现步骤导航（选择 → 上传 → 预览 → 确认）
  - 实现导入进度显示
  - 实现错误处理和提示
  - _需求: 1.5, 1.6, 1.7, 1.8_

### 阶段 3: 标注工作室 - Canvas 标注引擎

- [ ] 6. 集成 Konva.js 和基础 Canvas
  - [ ] 6.1 安装和配置 Konva.js 和 react-konva
    - 添加依赖包
    - 创建基础 Canvas 组件
    - _需求: 3.1_
  
  - [ ] 6.2 实现图片加载和显示
    - 实现图片加载逻辑
    - 实现图片缩放和平移
    - 实现图片适应画布
    - _需求: 3.1_
  
  - [ ] 6.3 实现图层管理
    - 创建图片层、标注层、交互层
    - 实现图层切换和显示控制
    - _需求: 3.1_

- [ ] 7. 实现目标检测标注工具
  - [ ] 7.1 实现矩形框工具
    - 实现矩形框绘制
    - 实现矩形框编辑（拖拽、调整大小）
    - 实现矩形框删除
    - _需求: 3.1, 3.2, 3.4, 3.5_
  
  - [ ] 7.2 实现圆形和点工具
    - 实现圆形标注绘制和编辑
    - 实现点标注创建和编辑
    - _需求: 3.1_
  
  - [ ] 7.3 实现标签选择和管理
    - 创建标签选择下拉菜单
    - 实现标签颜色显示
    - 实现标签编辑
    - _需求: 3.3, 3.4_

- [ ]*7.4 编写标注工具属性测试
  - **属性 4: 标注数据完整性**
  - **验证需求: 3.1-3.8**
  - 测试标注操作后数据状态正确性

- [ ] 8. 实现图像分割标注工具
  - [ ] 8.1 实现多边形工具
    - 实现多边形点击绘制
    - 实现顶点编辑（添加、删除、移动）
    - 实现多边形闭合
    - _需求: 4.1, 4.2, 4.6_
  
  - [ ] 8.2 实现画笔工具
    - 实现自由绘制功能
    - 实现画笔大小调整
    - 实现橡皮擦功能
    - _需求: 4.3_
  
  - [ ] 8.3 实现智能选择工具
    - 实现基于颜色的区域选择
    - 实现选区转多边形
    - _需求: 4.4_

- [ ]*8.4 编写分割标注属性测试
  - **属性 22: 标注几何有效性**
  - **验证需求: 4.1-4.7**
  - 测试分割标注坐标和尺寸有效性

### 阶段 4: 标注工作室 - 视频标注

- [ ] 9. 实现视频播放器
  - [ ] 9.1 创建 VideoPlayer 组件
    - 实现视频加载和播放控制
    - 实现时间轴显示
    - 实现逐帧控制（前进/后退）
    - _需求: 5.1, 5.2_
  
  - [ ] 9.2 实现帧提取和缓存
    - 实现关键帧提取
    - 实现帧缓存到 IndexedDB
    - 实现帧预加载
    - _需求: 5.1_

- [ ] 10. 实现视频标注功能
  - [ ] 10.1 实现关键帧标注
    - 实现在特定帧创建标注
    - 实现标注与帧号关联
    - _需求: 5.3_
  
  - [ ] 10.2 实现标注插值
    - 实现两个关键帧之间的线性插值
    - 实现插值参数配置
    - _需求: 5.4_
  
  - [ ] 10.3 实现对象跟踪
    - 实现对象 ID 分配
    - 实现跨帧对象关联
    - 实现跟踪轨迹显示
    - _需求: 5.5_

- [ ]*10.4 编写视频标注属性测试
  - **属性 5: 视频标注帧关联**
  - **属性 6: 视频标注插值一致性**
  - **验证需求: 5.3, 5.4, 5.5**

### 阶段 5: AI 模型辅助标注

- [ ] 11. 实现 AI 模型集成
  - [ ] 11.1 创建模型 API 客户端
    - 实现 API 请求封装
    - 实现错误处理和重试
    - _需求: 6.1_
  
  - [ ] 11.2 实现预标注生成
    - 调用 AI 模型 API
    - 解析模型响应
    - 转换预测结果为标注格式
    - _需求: 6.1, 6.2_
  
  - [ ] 11.3 实现预标注显示和审核
    - 显示预标注和置信度
    - 实现接受/拒绝/修改操作
    - 实现批量接受功能
    - _需求: 6.3, 6.4, 6.5_

- [ ]*11.4 编写 AI 预标注属性测试
  - **属性 7: AI预标注置信度过滤**
  - **验证需求: 6.5**

### 阶段 6: 项目和任务管理

- [ ] 12. 实现项目管理
  - [ ] 12.1 创建项目 CRUD 组件
    - 实现项目列表显示
    - 实现项目创建表单
    - 实现项目编辑和删除
    - _需求: 2.1, 2.3_
  
  - [ ] 12.2 实现类别管理
    - 实现类别列表显示
    - 实现类别添加/编辑/删除
    - 实现类别颜色选择
    - _需求: 2.1_

- [ ]*12.3 编写项目管理属性测试
  - **属性 1: 创建操作保留所有字段**
  - **验证需求: 2.1**

- [ ] 13. 实现任务管理
  - [ ] 13.1 创建任务 CRUD 组件
    - 实现任务列表显示
    - 实现任务创建和分配
    - 实现任务状态更新
    - _需求: 2.2, 2.3, 2.4_
  
  - [ ] 13.2 实现任务搜索和过滤
    - 实现按状态过滤
    - 实现按标注者过滤
    - 实现按日期范围过滤
    - _需求: 2.6_

- [ ]*13.3 编写任务管理属性测试
  - **属性 2: 状态转换记录历史**
  - **属性 3: 搜索结果符合过滤条件**
  - **验证需求: 2.5, 2.6**

### 阶段 7: 质量控制工作流

- [ ] 14. 实现审核工作流
  - [ ] 14.1 创建审核界面
    - 实现待审核任务列表
    - 实现标注审核视图
    - 实现审核操作（接受/拒绝/修改）
    - _需求: 7.1, 7.2, 7.3_
  
  - [ ] 14.2 实现审核记录
    - 记录审核操作和时间
    - 记录拒绝原因
    - 实现审核历史查看
    - _需求: 7.4, 7.5, 7.6_

- [ ]*14.3 编写审核工作流属性测试
  - **属性 8: 审核流程状态一致性**
  - **验证需求: 7.1-7.6**

- [ ] 15. 实现标注一致性检查
  - [ ] 15.1 实现一致性计算
    - 实现 IoU 计算
    - 实现 Kappa 系数计算
    - _需求: 8.1, 8.2_
  
  - [ ] 15.2 实现一致性可视化
    - 显示一致性指标
    - 高亮不一致标注
    - 并排显示不同标注者结果
    - _需求: 8.3, 8.4, 8.5_

- [ ]*15.3 编写一致性检查属性测试
  - **属性 9: 标注者间一致性计算正确性**
  - **验证需求: 8.1, 8.2**

### 阶段 8: 团队协作功能

- [ ] 16. 实现用户角色和权限
  - [ ] 16.1 实现权限检查逻辑
    - 创建权限检查 Hook
    - 实现基于角色的访问控制
    - _需求: 9.1, 9.2_
  
  - [ ] 16.2 实现权限 UI 控制
    - 根据权限显示/隐藏功能
    - 实现权限不足提示
    - _需求: 9.3, 9.4, 9.5_

- [ ]*16.3 编写权限控制属性测试
  - **属性 10: 权限控制正确性**
  - **验证需求: 9.1-9.5**

- [ ] 17. 实现进度跟踪
  - 实现项目进度统计
  - 实现标注者统计
  - 实现审核者统计
  - 实现时间线视图
  - _需求: 10.1, 10.2, 10.3, 10.4_

- [ ]*17.1 编写进度跟踪属性测试
  - **属性 11: 进度统计准确性**
  - **验证需求: 10.1, 10.2**

### 阶段 9: 数据导出

- [ ] 18. 实现数据导出功能
  - [ ] 18.1 实现 COCO 格式导出
    - 生成 COCO JSON 文件
    - 打包图片和标注文件
    - _需求: 11.1, 11.2_
  
  - [ ] 18.2 实现 YOLO 格式导出
    - 生成 YOLO TXT 文件
    - 生成类别配置文件
    - _需求: 11.3_
  
  - [ ] 18.3 实现其他格式导出
    - 实现 Pascal VOC 导出
    - 实现 CVAT 导出
    - _需求: 11.4_
  
  - [ ] 18.4 实现导出 UI
    - 创建导出对话框
    - 实现格式选择
    - 实现下载功能
    - _需求: 11.5, 11.6, 11.7_

- [ ]*18.5 编写数据导出属性测试
  - **属性 12: 数据导出往返一致性**
  - **验证需求: 11.2-11.4**

### 阶段 10: 数据中心

- [ ] 19. 实现数据集展示
  - [ ] 19.1 创建数据集列表组件
    - 实现卡片式展示
    - 实现数据集统计显示
    - _需求: 12.1, 12.2_
  
  - [ ] 19.2 创建数据集详情页面
    - 显示完整描述和统计
    - 实现样本预览
    - 实现下载选项
    - _需求: 12.3, 12.4_
  
  - [ ] 19.3 实现数据集搜索
    - 实现搜索输入框
    - 实现按名称/标签/类别搜索
    - _需求: 12.5_

- [ ]*19.4 编写数据集展示属性测试
  - **属性 13: 数据集搜索结果正确性**
  - **验证需求: 12.5**

- [ ] 20. 实现数据集版本控制
  - 实现版本自动创建
  - 实现版本历史显示
  - 实现版本比较
  - 实现版本回滚
  - _需求: 14.1, 14.2, 14.3, 14.4_

- [ ]*20.1 编写版本控制属性测试
  - **属性 14: 版本历史完整性**
  - **属性 15: 版本差异计算正确性**
  - **验证需求: 14.1, 14.2, 14.3**

- [ ] 21. 实现数据集管理
  - 实现数据集编辑
  - 实现数据集删除
  - 实现数据集分享
  - _需求: 15.1, 15.2, 15.3, 15.4, 15.5_

### 阶段 11: 看板和统计分析

- [ ] 22. 实现标注统计看板
  - [ ] 22.1 实现统计卡片
    - 显示总数据集数量
    - 显示总标注数量
    - 显示完成率
    - _需求: 16.1_
  
  - [ ] 22.2 实现趋势图表
    - 实现每日标注数量折线图
    - 实现时间范围选择
    - _需求: 16.2, 16.4_
  
  - [ ] 22.3 实现项目统计
    - 显示项目进度
    - 显示任务状态分布
    - _需求: 16.3_

- [ ] 23. 实现标签分析
  - 实现标签统计计算
  - 实现标签分布图表（柱状图/饼图）
  - 实现标签详情和样本预览
  - 实现数据不平衡检测
  - _需求: 17.1, 17.2, 17.3, 17.4_

- [ ]*23.1 编写标签分析属性测试
  - **属性 16: 标签统计准确性**
  - **验证需求: 17.1, 17.2**

- [ ] 24. 实现质量指标看板
  - 实现质量指标统计
  - 实现标注者质量展示
  - 实现审核者质量展示
  - 实现质量趋势图表
  - _需求: 18.1, 18.2, 18.3, 18.5_

- [ ]*24.1 编写质量指标属性测试
  - **属性 17: 质量指标计算正确性**
  - **验证需求: 18.1, 18.2**

### 阶段 12: 大模型管理

- [ ] 25. 实现模型提供商管理
  - 实现提供商列表显示
  - 实现提供商添加/编辑/删除
  - 实现连接验证
  - _需求: 19.1, 19.2, 19.3, 19.4, 19.5_

- [ ] 26. 实现 API 密钥管理
  - [ ] 26.1 实现密钥加密存储
    - 使用 Web Crypto API 加密
    - 实现密钥解密
    - _需求: 20.1_
  
  - [ ] 26.2 实现密钥管理 UI
    - 实现密钥添加/更新/删除
    - 实现密钥部分显示
    - 实现密钥过期提醒
    - _需求: 20.2, 20.3, 20.4, 20.5_

- [ ]*26.3 编写密钥管理属性测试
  - **属性 18: API密钥加密往返一致性**
  - **验证需求: 20.1, 20.2**

- [ ] 27. 实现模型列表管理
  - 实现模型列表显示
  - 实现模型选择
  - 实现模型测试
  - _需求: 21.1, 21.2, 21.3, 21.5_

### 阶段 13: 用户中心

- [ ] 28. 实现用户认证
  - [ ] 28.1 创建登录页面
    - 实现登录表单
    - 实现表单验证
    - 实现错误提示
    - _需求: 22.1, 22.2, 22.4_
  
  - [ ] 28.2 创建注册页面
    - 实现注册表单
    - 实现邮箱和密码验证
    - _需求: 22.5, 22.6_
  
  - [ ] 28.3 实现会话管理
    - 实现登录状态保持
    - 实现自动登录
    - 实现登出功能
    - _需求: 22.3_

- [ ] 29. 实现用户资料管理
  - 实现资料显示页面
  - 实现资料编辑表单
  - 实现头像上传
  - 实现密码修改
  - _需求: 23.1, 23.2, 23.3, 23.4, 23.5_

### 阶段 14: 数据持久化和同步

- [ ] 30. 实现数据同步机制
  - [ ] 30.1 实现增量同步
    - 实现本地变更追踪
    - 实现增量数据上传
    - _需求: 25.2, 25.3_
  
  - [ ] 30.2 实现冲突检测和解决
    - 实现版本冲突检测
    - 实现冲突解决 UI
    - _需求: 25.6_
  
  - [ ] 30.3 实现后台同步
    - 使用 Web Workers 后台同步
    - 实现同步状态显示
    - _需求: 25.3_

- [ ]*30.4 编写数据同步属性测试
  - **属性 19: 数据持久化往返一致性**
  - **属性 20: 数据同步往返一致性**
  - **属性 21: 冲突检测正确性**
  - **验证需求: 25.1, 25.2, 25.6**

### 阶段 15: 性能优化和完善

- [ ] 31. 实现性能优化
  - [ ] 31.1 实现虚拟滚动
    - 为数据集列表实现虚拟滚动
    - 为任务列表实现虚拟滚动
    - _需求: 12.1_
  
  - [ ] 31.2 实现图片懒加载
    - 使用 Intersection Observer
    - 实现占位符显示
    - _需求: 12.2_
  
  - [ ] 31.3 优化 Canvas 性能
    - 实现图层分离
    - 实现形状缓存
    - 实现批量更新
    - _需求: 3.1, 4.1_

- [ ] 32. 实现响应式设计
  - 实现桌面布局
  - 实现平板布局
  - 实现移动端布局
  - 实现触摸操作优化
  - _需求: 26.1, 26.2, 26.3, 26.4, 26.5_

- [ ] 33. 实现错误处理和日志
  - 实现全局错误边界
  - 实现错误日志记录
  - 实现错误上报
  - _需求: 1.8, 6.6_

- [ ] 34. 实现国际化
  - 集成 i18next
  - 添加中英文翻译
  - 实现语言切换
  - _需求: 无_

- [ ] 35. 最终检查点
  - 确保所有测试通过
  - 检查代码质量
  - 优化构建配置
  - 准备部署文档

## 注意事项

1. **可选任务**: 标记为 `*` 的任务为可选任务，主要是测试相关任务。可以根据项目时间和优先级决定是否实施。
2. **增量开发**: 每个阶段完成后应该有可演示的功能，建议在每个阶段结束时进行演示和反馈。
3. **测试策略**: 属性测试使用 fast-check 库，每个测试至少运行 100 次迭代。
4. **代码审查**: 每个阶段完成后应进行代码审查，确保代码质量和一致性。
5. **文档更新**: 在实施过程中如发现设计问题，应及时更新设计文档。
